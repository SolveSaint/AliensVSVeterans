@use "./base.scss";

/* =========================
   STRONG GLOBAL TEXTURED BACKGROUND
   Night forest green bias + tall pine silhouettes (SVG)
   ========================= */
body {
  background-color: #0a120e;

  background-image:
    /* SEAMLESS TALL PINE TREELINE, REPEATS ACROSS BOTTOM */
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 600' preserveAspectRatio='none'%3E%3Cg fill='rgba(0,0,0,0.85)'%3E%3Cpath d='M0 600 L0 450 L40 390 L70 450 L110 330 L150 470 L200 310 L250 500 L300 360 L350 540 L400 380 L450 560 L500 410 L550 585 L600 430 L650 560 L700 380 L750 540 L800 360 L850 500 L900 310 L950 470 L990 330 L1030 450 L1060 390 L1100 450 L1100 600 Z'/%3E%3Cpath d='M1100 600 L1100 450 L1140 390 L1170 450 L1200 450 L1200 600 Z'/%3E%3Cpath d='M0 600 L0 450 L30 405 L55 450 L95 345 L130 465 L175 330 L215 490 L265 350 L315 525 L365 370 L415 550 L465 400 L515 575 L565 420 L615 550 L665 370 L715 525 L765 350 L815 490 L865 330 L905 465 L945 345 L970 450 L1000 405 L1030 450 L1030 600 Z' opacity='0.92'/%3E%3C/g%3E%3C/svg%3E"),

    /* FOG FADE ABOVE TREES, REPEATS ACROSS BOTTOM */
    linear-gradient(
      to top,
      rgba(0, 0, 0, 0.65) 0%,
      rgba(10, 18, 14, 0.42) 32%,
      rgba(10, 18, 14, 0.22) 58%,
      rgba(10, 18, 14, 0) 86%
    ),

    /* YOUR EXISTING NIGHT FOREST TEXTURE */
    radial-gradient(
      ellipse at center,
      rgba(255, 255, 255, 0.055) 0%,
      rgba(255, 255, 255, 0.028) 35%,
      rgba(0, 0, 0, 0.36) 70%,
      rgba(0, 0, 0, 0.64) 100%
    ),
    radial-gradient(
      rgba(255, 255, 255, 0.07) 1px,
      transparent 1px
    ),
    radial-gradient(
      rgba(255, 255, 255, 0.035) 1px,
      transparent 1px
    );

background-size:
  1200px 950px,
  100% 950px,
  100% 100%,
  5px 5px,
  2px 2px;

  background-position:
    left bottom,
    center bottom,
    center,
    0 0,
    1px 1px;

  background-repeat:
    repeat-x,
    no-repeat,
    no-repeat,
    repeat,
    repeat;
}

/* =========================
   GLOBAL TEXT PALETTE
   Warm neutrals tuned for dark green
   ========================= */
html,
body,
#quartz-root,
#quartz-body {
  color: #e6ebe7;
}

/* Make common low emphasis text read cleanly on green */
.page-meta,
.content-meta,
.breadcrumb,
.breadcrumbs,
.left.sidebar,
.right.sidebar,
.toc,
.graph,
footer {
  color: #9aa8a0;
}

/* Links */
a {
  color: #7fb4ff;
}

a:hover {
  color: #a7c9ff;
}

/* Headings inside articles (do not touch your hero title) */
.center article h1,
.center article h2,
.center article h3,
.center article h4,
.center article h5,
.center article h6 {
  color: #f1f5f2;
}

/* Code should remain readable */
code,
pre {
  color: #e6ebe7;
}

/* =========================
   GLOBAL WIDTH SAFETY
   ========================= */
html,
body,
#quartz-root,
#quartz-body {
  width: 100%;
  max-width: 100%;
}

/* Prevent layout blowouts */
*,
*::before,
*::after {
  box-sizing: border-box;
}

/* Media should never push width */
img,
svg,
video,
canvas {
  max-width: 100%;
  height: auto;
}

/* Code blocks scroll internally, not the page */
pre {
  max-width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

code {
  overflow-wrap: anywhere;
  word-break: break-word;
}

/* Wrap long text in the reading area only */
.center article p,
.center article li,
.center article blockquote,
.center article h1,
.center article h2,
.center article h3,
.center article h4,
.center article h5,
.center article h6,
.center article strong,
.center article em,
.center article a {
  overflow-wrap: anywhere;
  word-break: break-word;
  hyphens: auto;
}

/* Allow flex children to shrink on mobile */
#quartz-body,
.center,
main,
article,
.content {
  min-width: 0;
}

/* =========================
   GLOBAL LAYOUT PULL UP
   ========================= */
#quartz-root,
#quartz-body,
.center,
.center .page-header,
.center .page-header header {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

.center .page-header header {
  margin: 0 !important;
  padding: 0 !important;
}

.center .page-header header > div {
  margin-bottom: 0 !important;
}

.center .page-header figure,
.center .page-header picture {
  margin: 0 !important;
}

.center .page-header img,
.center .page-header a {
  display: block;
}

/* =========================
   SIDEBARS
   ========================= */
.left.sidebar,
.right.sidebar {
  margin-top: 0 !important;
  padding-top: 1rem !important;
}

.left.sidebar .page-title {
  margin-top: 0 !important;
}

.right.sidebar .graph {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

#quartz-body {
  align-items: flex-start !important;
}

/* =========================
   FAKE H1 HERO TITLE
   ========================= */
.avv-title {
  white-space: nowrap;
  font-size: clamp(2.4rem, 4.2vw, 3.6rem);
  font-weight: 500;
  line-height: 1.08;
  margin: 0 0 2rem 0;
  color: #e6ebe7;
  text-align: center;
  letter-spacing: 0.01em;
  transform: translateZ(0);
  text-shadow:
    0 1px 2px rgba(0, 0, 0, 0.8),
    0 4px 12px rgba(0, 0, 0, 0.45);
  animation: avvFadeIn 600ms ease-out both;
}

.avv-title span {
  display: inline;
}

.avv-title::after {
  content: "";
  display: block;
  width: 360px;
  height: 7px;
  margin: 0.8rem auto 0;
  background: linear-gradient(90deg, #c43c3c, #ffffff, #1f4ed8);
  border-radius: 2px;
  opacity: 0.85;
}

/* Color tokens */
.avv-welcome {
  color: #f2c94c;
  font-weight: 500;
  opacity: 0.92;
  text-shadow: 0 0 14px rgba(242, 201, 76, 0.42);
}

.avv-aliens {
  color: #c43c3c;
  font-weight: 500;
  letter-spacing: 0.01em;
  text-shadow: 0 0 14px rgba(196, 60, 60, 0.4);
}

.avv-veterans {
  color: #1f4ed8;
  font-weight: 500;
  letter-spacing: 0.01em;
  text-shadow: 0 0 14px rgba(31, 78, 216, 0.36);
}

.avv-welcome,
.avv-aliens,
.avv-veterans {
  letter-spacing: 0.01em;
}

@keyframes avvFadeIn {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* =========================
   META ROW TIGHTENING
   ========================= */
.page-meta,
.content-meta,
.breadcrumb,
.breadcrumbs {
  margin-top: 0.25rem !important;
}

.center .page-header .popover-hint,
.center .page-header .content-meta {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

.center .page-header .content-meta {
  margin-bottom: 0.35rem !important;
}

/* =========================
   TOP LEFT SITE TITLE
   ========================= */
.left.sidebar .page-title a {
  font-weight: 600;
  letter-spacing: 0.01em;
  text-decoration: none;

  background: linear-gradient(
    90deg,
    #c43c3c 0%,
    #c43c3c 38%,
    #ffffff 38%,
    #ffffff 52%,
    #1f4ed8 52%,
    #1f4ed8 100%
  );
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;

  text-shadow:
    0 0 14px rgba(196, 60, 60, 0.22),
    0 0 14px rgba(31, 78, 216, 0.22);
}

/* Do not let the site title break per character */
.left.sidebar .page-title,
.left.sidebar .page-title a {
  overflow-wrap: normal !important;
  word-break: keep-all !important;
  hyphens: none !important;
  white-space: nowrap !important;
}

/* =========================
   MOBILE: WRAP HERO TITLE
   ========================= */
@media (max-width: 700px) {
  .avv-title {
    white-space: normal;
    text-wrap: balance;
  }

  .avv-title::after {
    width: min(360px, 92vw);
  }
}

/* =========================
   MOBILE: FIX HEADER ROW (TITLE + SEARCH)
   Make the search box shrink so AVSV shows fully
   ========================= */
@media (max-width: 700px) {
  .left.sidebar {
    width: 100% !important;
    max-width: 100% !important;
  }

  .left.sidebar .page-title {
    min-width: 0 !important;
  }

  .left.sidebar .page-title a {
    max-width: none !important;
    overflow: visible !important;
    text-overflow: clip !important;
  }

  /* Shrink search so the title can show */
  .left.sidebar input[type="search"],
  .left.sidebar .search input,
  .left.sidebar .searchbar input {
    width: 9.5rem !important;
    max-width: 9.5rem !important;
  }

  /* Prevent search container from eating the row */
  .left.sidebar .search,
  .left.sidebar .searchbar {
    flex: 0 0 auto !important;
  }
}

/* =========================
   MOBILE FONT SIZE BOOST
   ========================= */
@media (max-width: 700px) {
  body {
    font-size: 1.05rem;
  }

  p,
  li,
  blockquote {
    font-size: 1.1rem;
    line-height: 1.65;
  }

  h1 {
    font-size: 1.6rem;
  }

  h2 {
    font-size: 1.4rem;
  }

  h3 {
    font-size: 1.25rem;
  }

  h4 {
    font-size: 1.15rem;
  }

  .left.sidebar,
  .right.sidebar {
    font-size: 0.95rem;
  }

  .page-meta,
  .content-meta,
  .breadcrumb,
  .breadcrumbs {
    font-size: 0.85rem;
  }
}

/* =========================
   FORCE DARK MODE ONLY
   Keep Quartz variables aligned with our night forest palette
   ========================= */
:root {
  color-scheme: dark !important;
}

html[data-theme="light"],
html[data-theme="light"] body {
  background-color: #0a120e !important;
  color: #e6ebe7 !important;
}

html,
html[data-theme],
html[data-theme="dark"] {
  --background: #0a120e !important;
  --text: #e6ebe7 !important;
}

/* =========================
   REMOVE THEME TOGGLE (MOON ICON)
   ========================= */
button[aria-label*="theme"],
button[title*="theme"],
button[aria-label*="dark"],
button[aria-label*="light"],
a[aria-label*="theme"],
a[title*="theme"],
svg[data-icon*="moon"],
svg[data-icon*="sun"],
.theme-toggle,
.theme-switch,
.darkmode-toggle,
.lightmode-toggle {
  display: none !important;
}

/* =========================
   REMOVE BOOK ICON
   ========================= */
button[aria-label*="reader"],
button[title*="reader"],
button[aria-label*="book"],
button[title*="book"],
a[aria-label*="reader"],
a[title*="reader"],
a[aria-label*="book"],
a[title*="book"],
svg[data-icon*="book"],
.book,
.book-toggle,
.reader-toggle {
  display: none !important;
}

/* =========================
   EXPLORER ACTIVE LINK
   ========================= */
.explorer-content a.is-active {
  background-color: rgba(96, 163, 255, 0.24);
  color: #eef4f0;
  border-radius: 8px;
  box-shadow: inset 2px 0 0 rgba(96, 163, 255, 0.75);
}

.explorer-content a.is-active::after {
  background: rgba(96, 163, 255, 0.22);
}

/* =========================
   EXPLORER HOVER HIGHLIGHT
   ========================= */
.explorer-content a:not(.folder-title):hover {
  background-color: rgba(96, 163, 255, 0.15);
  color: #eef4f0;
  border-radius: 8px;
}

/* =========================
   EXPLORER CHEVRON INDICATOR
   Left gutter + soft fade
   ========================= */
.explorer-content .explorer-ul > li > a:not(.folder-title),
.explorer-content ul.content > li > a:not(.folder-title) {
  position: relative;
  padding-left: 28px;
  transition: background-color 220ms ease, color 220ms ease;
}

.explorer-content .explorer-ul > li > a:not(.folder-title)::before,
.explorer-content ul.content > li > a:not(.folder-title)::before {
  content: "›";
  position: absolute;
  left: 12px;
  top: 50%;

  font-size: 1.15rem;
  line-height: 1;
  color: rgba(96, 163, 255, 0.9);

  transform: translateY(-50%) translateX(-2px);
  opacity: 0;

  transition: opacity 220ms ease, transform 220ms ease;
}

.explorer-content .explorer-ul > li > a:not(.folder-title):hover::before,
.explorer-content ul.content > li > a:not(.folder-title):hover::before {
  opacity: 0.95;
  transform: translateY(-50%) translateX(0);
}

.explorer-content a.is-active::before {
  opacity: 1;
  transform: translateY(-50%) translateX(0);
  color: rgba(96, 163, 255, 0.98);
}

@media (prefers-reduced-motion: reduce) {
  .explorer-content .explorer-ul > li > a:not(.folder-title),
  .explorer-content ul.content > li > a:not(.folder-title),
  .explorer-content .explorer-ul > li > a:not(.folder-title)::before,
  .explorer-content ul.content > li > a:not(.folder-title)::before {
    transition: none !important;
  }
}

/* =========================
   TABLE OF CONTENTS CHEVRON
   No overlap, chevron unaffected by link fade
   ========================= */

/* Each TOC row owns the gutter */
.toc li {
  position: relative;
}

/* Make the link occupy the row and start after the gutter */
.toc li > a {
  display: block;
  padding-left: 24px !important;
  border-radius: 6px;
}

/* Chevron sits in the gutter */
.toc li::before {
  content: "›";
  position: absolute;
  left: 8px;
  top: 50%;

  font-size: 1.05rem;
  line-height: 1;
  color: rgba(96, 163, 255, 0.9);

  transform: translateY(-50%) translateX(-2px);
  opacity: 0;

  transition: opacity 220ms ease, transform 220ms ease;
  pointer-events: none;
}

/* Hover fade-in */
.toc li:hover::before {
  opacity: 0.95;
  transform: translateY(-50%) translateX(0);
}

/* Active section marker */
.toc li:has(> a.active)::before {
  opacity: 1;
  transform: translateY(-50%) translateX(0);
  color: rgba(96, 163, 255, 0.98);
}

/* Optional row hover background without changing text fade logic */
.toc li > a:hover {
  background-color: rgba(96, 163, 255, 0.12);
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .toc li::before {
    transition: none !important;
  }
}
/* =========================
   SIDE CAMOUFLAGE IMPACT
   Military / forest camo texture on page edges
   ========================= */

body::after {
  content: "";
  position: fixed;
  inset: 0;

  pointer-events: none;
  z-index: 0;

  /* Fade in from below header so hero stays clean */
  -webkit-mask-image: linear-gradient(
    to bottom,
    rgba(0, 0, 0, 0) 0%,
    rgba(0, 0, 0, 0) 16%,
    rgba(0, 0, 0, 0.75) 32%,
    rgba(0, 0, 0, 1) 100%
  );
  mask-image: linear-gradient(
    to bottom,
    rgba(0, 0, 0, 0) 0%,
    rgba(0, 0, 0, 0) 16%,
    rgba(0, 0, 0, 0.75) 32%,
    rgba(0, 0, 0, 1) 100%
  );

  background-image:
    /* LEFT CAMO */
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 1200'%3E%3Cg fill='%230b1a12'%3E%3Cpath d='M0 0 L140 0 L110 60 L160 120 L90 200 L150 280 L70 360 L140 450 L60 540 L135 630 L55 720 L130 810 L50 900 L120 990 L90 1200 L0 1200 Z'/%3E%3Cpath d='M160 0 L320 0 L280 90 L330 170 L260 260 L320 350 L250 450 L310 560 L240 680 L300 800 L230 940 L290 1080 L250 1200 L160 1200 Z' fill='%23060f0a'/%3E%3Cpath d='M320 0 L600 0 L600 1200 L360 1200 L420 1100 L370 980 L460 880 L390 770 L490 680 L410 580 L520 490 L430 400 L540 320 L450 250 L560 190 L470 130 L580 80 L490 40 Z' fill='%23121f18'/%3E%3C/g%3E%3C/svg%3E"),
    linear-gradient(to right, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0) 22%),

    /* RIGHT CAMO (mirrored by gradient direction) */
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 1200'%3E%3Cg fill='%230b1a12'%3E%3Cpath d='M0 0 L140 0 L110 60 L160 120 L90 200 L150 280 L70 360 L140 450 L60 540 L135 630 L55 720 L130 810 L50 900 L120 990 L90 1200 L0 1200 Z'/%3E%3Cpath d='M160 0 L320 0 L280 90 L330 170 L260 260 L320 350 L250 450 L310 560 L240 680 L300 800 L230 940 L290 1080 L250 1200 L160 1200 Z' fill='%23060f0a'/%3E%3Cpath d='M320 0 L600 0 L600 1200 L360 1200 L420 1100 L370 980 L460 880 L390 770 L490 680 L410 580 L520 490 L430 400 L540 320 L450 250 L560 190 L470 130 L580 80 L490 40 Z' fill='%23121f18'/%3E%3C/g%3E%3C/svg%3E"),
    linear-gradient(to left, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0) 22%);

  background-repeat:
    repeat-y,
    no-repeat,
    repeat-y,
    no-repeat;

  background-size:
    320px 980px,
    320px 100%,
    320px 980px,
    320px 100%;

  background-position:
    left top,
    left top,
    right top,
    right top;

  opacity: 0.45;
}
